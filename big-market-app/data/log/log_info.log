24-11-08.12:19:50.050 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 33590 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:19:50.051 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:19:51.625 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:19:51.630 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:19:51.702 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 44 ms. Found 0 Redis repository interfaces.
24-11-08.12:19:53.301 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:19:53.533 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:19:53.547 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:19:57.521 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:19:57.629 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:19:57.739 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#25ae1f80:0/SimpleConnection@13137835 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 34838]
24-11-08.12:19:57.844 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.467 seconds (JVM running for 9.661)
24-11-08.12:19:58.085 [main            ] INFO  RaffleActivityController - 活动装配，数据预热，开始: activityId:100301
24-11-08.12:19:58.120 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:19:58.452 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:19:58.971 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
24-11-08.12:19:58.988 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:19:58.989 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:19:59.819 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:19:59.821 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:19:59.824 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:19:59.825 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:20:45.068 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 34310 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:20:45.070 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:20:46.553 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:20:46.560 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:20:46.621 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
24-11-08.12:20:48.799 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:20:49.100 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:20:49.116 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:20:52.738 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:20:52.845 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:20:52.902 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#14a1769d:0/SimpleConnection@38923cfe [delegate=amqp://admin@127.0.0.1:5672/, localPort= 58476]
24-11-08.12:20:53.015 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.626 seconds (JVM running for 9.665)
24-11-08.12:20:53.257 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.12:20:53.383 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:20:53.643 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:20:53.685 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=743453538353, orderTime=Thu Nov 07 18:49:45 CST 2024, orderState=create, endDateTime=null)
24-11-08.12:20:53.706 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: 103
24-11-08.12:20:53.706 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 103 rule_default
24-11-08.12:20:53.707 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:20:53.733 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:20:53.814 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rule_tree_node where tree_id = 'tree_luck_award'' at line 2
### The error may exist in file [/home/mufen/Downloads/big-market/big-market-app/target/classes/mybatis/mapper/rule_tree_node_mapper.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: select tree_id, rule_key, rule_desc, rule_value,         from rule_tree_node where tree_id = ?
### Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rule_tree_node where tree_id = 'tree_luck_award'' at line 2
; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rule_tree_node where tree_id = 'tree_luck_award'' at line 2
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:239)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy113.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:224)
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy138.queryRuleTreeNodeListByTreeId(Unknown Source)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository.queryRuleTreeVOByTreeId(StrategyRepository.java:183)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$4915b6c7.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$468442f8.queryRuleTreeVOByTreeId(<generated>)
	at site.mufen.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicTree(DefaultRaffleStrategy.java:67)
	at site.mufen.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:65)
	at site.mufen.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:113)
	at site.mufen.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
Caused by: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rule_tree_node where tree_id = 'tree_luck_award'' at line 2
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:64)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:79)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy205.query(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:63)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:325)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:89)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:140)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 55 common frames omitted
24-11-08.12:20:54.080 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.12:20:54.085 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","info":"未知失败"}
24-11-08.12:20:54.107 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:20:54.107 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:20:54.983 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:20:54.989 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:20:54.992 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:20:54.992 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:21:48.628 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 35161 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:21:48.631 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:21:50.159 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:21:50.168 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:21:50.259 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 49 ms. Found 0 Redis repository interfaces.
24-11-08.12:21:52.536 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:21:52.900 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:21:52.995 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:21:57.092 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:21:57.222 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:21:57.290 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#4fe8f2ae:0/SimpleConnection@29c80149 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 58500]
24-11-08.12:21:57.390 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 9.452 seconds (JVM running for 10.43)
24-11-08.12:21:57.596 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.12:21:57.715 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:21:58.004 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:21:58.036 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=743453538353, orderTime=Thu Nov 07 18:49:45 CST 2024, orderState=create, endDateTime=null)
24-11-08.12:21:58.057 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: 106
24-11-08.12:21:58.058 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 106 rule_default
24-11-08.12:21:58.059 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:21:58.089 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:21:58.133 [main            ] INFO  RuleLockLogicTreeNode  - 规则过滤-次数锁 userId:xiaofuge strategyId:100006 awardId:106
24-11-08.12:21:58.145 [main            ] INFO  RuleLockLogicTreeNode  - 规则过滤-次数锁【拦截】 userId:xiaofuge strategyId:100006 awardId:106 raffleCount:0 userRaffleCount:0
24-11-08.12:21:58.146 [main            ] INFO  DecisionTreeEngine     - 决策树引擎【规则树】treeId:tree_lock_1 node:rule_lock code:0001
24-11-08.12:21:58.147 [main            ] INFO  RuleLuckAwardLogicTreeNode - 规则过滤-兜底奖品 userId:xiaofuge strategyId:100006 awardId:106 ruleValue:101:1,100
24-11-08.12:21:58.147 [main            ] INFO  RuleLuckAwardLogicTreeNode - 规则过滤-兜底奖品 userId:xiaofuge strategyId:100006 awardId:101 awardRuleValue:1,100
24-11-08.12:21:58.148 [main            ] INFO  DecisionTreeEngine     - 决策树引擎【规则树】treeId:tree_lock_1 node:rule_luck_award code:0001
24-11-08.12:21:58.148 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-规则树 xiaofuge 100006 101 1,100
24-11-08.12:21:58.414 [main            ] INFO  EventPublisher         - 发送MQ消息 topic: send_award, message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"xiaofuge"},"id":"60062587466","timestamp":1731039718163}
24-11-08.12:21:58.414 [main            ] INFO  AwardRepository        - 更新task表 任务消息发送完成
24-11-08.12:21:58.426 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"xiaofuge"},"id":"60062587466","timestamp":1731039718163}
24-11-08.12:21:58.427 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.12:21:58.431 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
24-11-08.12:21:58.451 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:21:58.451 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:21:59.368 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:21:59.430 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:21:59.434 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:21:59.435 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:23:52.811 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 36413 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:23:52.814 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:23:54.450 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:23:54.456 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:23:54.516 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 36 ms. Found 0 Redis repository interfaces.
24-11-08.12:23:56.640 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:23:56.951 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:23:56.968 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:24:01.703 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:24:01.856 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:24:01.953 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#591be8aa:0/SimpleConnection@1e23ee0e [delegate=amqp://admin@127.0.0.1:5672/, localPort= 45286]
24-11-08.12:24:02.079 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 10.022 seconds (JVM running for 11.042)
24-11-08.12:24:02.355 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.12:24:02.491 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:24:02.779 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:24:02.886 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: null
24-11-08.12:24:02.887 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 null rule_default
24-11-08.12:24:02.887 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:24:02.909 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:24:02.927 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
java.lang.NullPointerException: null
	at site.mufen.infrastructure.persistent.repository.StrategyRepository.queryRuleTreeVOByTreeId(StrategyRepository.java:217)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$4915b6c7.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$be23c6a1.queryRuleTreeVOByTreeId(<generated>)
	at site.mufen.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicTree(DefaultRaffleStrategy.java:67)
	at site.mufen.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:65)
	at site.mufen.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:113)
	at site.mufen.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
24-11-08.12:24:03.179 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.12:24:03.184 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","info":"未知失败"}
24-11-08.12:24:03.207 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:24:03.209 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:24:04.049 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:24:04.053 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:24:04.057 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:24:04.057 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:24:16.567 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 36818 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:24:16.569 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:24:18.079 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:24:18.084 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:24:18.159 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 44 ms. Found 0 Redis repository interfaces.
24-11-08.12:24:20.366 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:24:20.734 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:24:20.754 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:24:24.824 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:24:24.918 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:24:24.979 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#77ea806f:0/SimpleConnection@173cfb01 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 34136]
24-11-08.12:24:25.079 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 9.211 seconds (JVM running for 10.176)
24-11-08.12:24:25.280 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.12:24:25.394 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:24:25.684 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:24:25.718 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=924889330355, orderTime=Fri Nov 08 12:24:02 CST 2024, orderState=create, endDateTime=null)
24-11-08.12:24:25.742 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: 102
24-11-08.12:24:25.742 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 102 rule_default
24-11-08.12:24:25.743 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:24:25.775 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:24:25.812 [main            ] INFO  RuleStockLogicTreeNode - 规则过滤-库存扣减 userId:xiaofuge strategyId:100006 awardId:102
24-11-08.12:24:25.846 [main            ] INFO  DecisionTreeEngine     - 决策树引擎【规则树-兜底奖励】treeId:tree_luck_award node:rule_stock code:0001
24-11-08.12:24:25.847 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-规则树 xiaofuge 100006 102 null
24-11-08.12:24:26.105 [main            ] INFO  EventPublisher         - 发送MQ消息 topic: send_award, message: {"data":{"awardId":102,"awardTitle":"7等奖","userId":"xiaofuge"},"id":"81402035929","timestamp":1731039865863}
24-11-08.12:24:26.105 [main            ] INFO  AwardRepository        - 更新task表 任务消息发送完成
24-11-08.12:24:26.116 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":102,"awardTitle":"7等奖","userId":"xiaofuge"},"id":"81402035929","timestamp":1731039865863}
24-11-08.12:24:26.118 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.12:24:26.121 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":102,"awardIndex":2,"awardTitle":"7等奖"},"info":"成功"}
24-11-08.12:24:26.140 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:24:26.141 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:24:27.052 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:24:27.120 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:24:27.124 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:24:27.125 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:24:46.626 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 37272 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:24:46.628 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:24:48.093 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:24:48.099 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:24:48.158 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 30 ms. Found 0 Redis repository interfaces.
24-11-08.12:24:50.217 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:24:50.530 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:24:50.548 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:24:55.125 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:24:55.226 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:24:55.314 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#77ea806f:0/SimpleConnection@173cfb01 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 60024]
24-11-08.12:24:55.430 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 9.483 seconds (JVM running for 10.439)
24-11-08.12:24:55.699 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.12:24:55.824 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:24:56.089 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:24:56.187 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: 101
24-11-08.12:24:56.188 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 101 rule_default
24-11-08.12:24:56.188 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:24:56.216 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:24:56.235 [main            ] INFO  RuleStockLogicTreeNode - 规则过滤-库存扣减 userId:xiaofuge strategyId:100006 awardId:101
24-11-08.12:24:56.245 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
java.lang.NullPointerException: null
	at site.mufen.infrastructure.persistent.repository.StrategyRepository.subtractionAwardStock(StrategyRepository.java:254)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$4915b6c7.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$6ebdedc8.subtractionAwardStock(<generated>)
	at site.mufen.domain.strategy.service.armory.StrategyArmoryDispatch.subtractionAwardStock(StrategyArmoryDispatch.java:181)
	at site.mufen.domain.strategy.service.rule.tree.impl.RuleStockLogicTreeNode.logic(RuleStockLogicTreeNode.java:34)
	at site.mufen.domain.strategy.service.rule.tree.factory.engine.impl.DecisionTreeEngine.process(DecisionTreeEngine.java:48)
	at site.mufen.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicTree(DefaultRaffleStrategy.java:72)
	at site.mufen.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:65)
	at site.mufen.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:113)
	at site.mufen.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
24-11-08.12:24:56.459 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.12:24:56.463 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","info":"未知失败"}
24-11-08.12:24:56.483 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:24:56.484 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:24:57.394 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:24:57.401 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:24:57.405 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:24:57.406 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:53:15.826 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 47688 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:53:15.828 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:53:17.239 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:53:17.244 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:53:17.299 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
24-11-08.12:53:19.416 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:53:19.681 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:53:19.697 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:53:23.339 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:53:23.418 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:53:23.483 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1fcaea93:0/SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 37082]
24-11-08.12:53:23.566 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.39 seconds (JVM running for 10.355)
24-11-08.12:54:42.011 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.12:54:58.128 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:54:58.129 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:55:02.807 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:55:02.807 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:55:04.965 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=707494030054, orderTime=Fri Nov 08 12:24:56 CST 2024, orderState=create, endDateTime=null)
24-11-08.12:55:36.849 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: null
24-11-08.12:56:54.174 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=1m17s383ms735µs113ns).
24-11-08.12:56:54.174 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=1m17s383ms756µs527ns).
24-11-08.12:56:54.174 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 null rule_default
24-11-08.12:56:54.182 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.12:56:54.212 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.12:56:54.234 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
java.lang.NullPointerException: null
	at site.mufen.infrastructure.persistent.repository.StrategyRepository.queryRuleTreeVOByTreeId(StrategyRepository.java:217)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$4915b6c7.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$f289b52.queryRuleTreeVOByTreeId(<generated>)
	at site.mufen.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicTree(DefaultRaffleStrategy.java:67)
	at site.mufen.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:65)
	at site.mufen.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:113)
	at site.mufen.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
24-11-08.12:56:54.252 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:56:54.254 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.12:56:54.497 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.12:56:54.508 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","info":"未知失败"}
24-11-08.12:56:55.181 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:56:55.181 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.12:56:55.185 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:56:55.186 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.12:56:58.158 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 50004 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.12:56:58.160 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.12:56:59.526 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.12:56:59.531 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.12:56:59.591 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 34 ms. Found 0 Redis repository interfaces.
24-11-08.12:57:01.667 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.12:57:01.966 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:57:01.984 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.12:57:05.556 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.12:57:05.635 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.12:57:05.690 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1fcaea93:0/SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 39932]
24-11-08.12:57:05.765 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.27 seconds (JVM running for 9.589)
24-11-08.13:02:44.527 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.13:02:44.595 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:02:44.595 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:02:47.630 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@270f7b4d: tags=[[amq.ctag-RQAfKXSNKGoeVBngEZtb-Q]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,2), conn: Proxy@5a63fa71 Shared Rabbit Connection: SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 39932], acknowledgeMode=AUTO local queue size=0
24-11-08.13:02:47.630 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@6c6919ff: tags=[[amq.ctag-ABcczWYt6ZX5A6Zo42JmGQ]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,1), conn: Proxy@5a63fa71 Shared Rabbit Connection: SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 39932], acknowledgeMode=AUTO local queue size=0
24-11-08.13:02:47.633 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.13:02:47.639 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1fcaea93:1/SimpleConnection@4618c8c8 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 33460]
24-11-08.13:02:48.019 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:02:48.019 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:02:49.611 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=707494030054, orderTime=Fri Nov 08 12:24:56 CST 2024, orderState=create, endDateTime=null)
24-11-08.13:02:57.156 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: null
24-11-08.13:02:57.157 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 null rule_default
24-11-08.13:02:57.158 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:02:57.181 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:03:05.446 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
java.lang.NullPointerException: null
	at site.mufen.infrastructure.persistent.repository.StrategyRepository.queryRuleTreeVOByTreeId(StrategyRepository.java:217)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$4915b6c7.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$f289b52.queryRuleTreeVOByTreeId(<generated>)
	at site.mufen.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicTree(DefaultRaffleStrategy.java:67)
	at site.mufen.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:65)
	at site.mufen.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:113)
	at site.mufen.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
24-11-08.13:03:05.758 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.13:03:05.766 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","info":"未知失败"}
24-11-08.13:03:05.787 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.13:03:05.789 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.13:03:06.672 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-3] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.13:03:06.672 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-3] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.13:03:06.677 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.13:03:06.677 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.13:04:51.786 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 54204 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.13:04:51.789 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.13:04:53.109 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.13:04:53.114 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.13:04:53.171 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
24-11-08.13:04:55.153 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.13:04:55.452 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.13:04:55.471 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.13:04:59.617 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.13:04:59.696 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.13:04:59.753 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1fcaea93:0/SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 52704]
24-11-08.13:04:59.834 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.769 seconds (JVM running for 10.044)
24-11-08.13:05:00.029 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:05:00.029 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:05:02.511 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.13:08:47.157 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:08:47.157 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:08:53.161 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=707494030054, orderTime=Fri Nov 08 12:24:56 CST 2024, orderState=create, endDateTime=null)
24-11-08.13:08:53.165 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@270f7b4d: tags=[[amq.ctag-V1zZjAVZKx8EkR4FHCAYcg]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,2), conn: Proxy@5a63fa71 Shared Rabbit Connection: SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 52704], acknowledgeMode=AUTO local queue size=0
24-11-08.13:08:53.165 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@6c6919ff: tags=[[amq.ctag-Cfr5PW7qa_V_rpGL-X5o-Q]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,1), conn: Proxy@5a63fa71 Shared Rabbit Connection: SimpleConnection@b56d8a7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 52704], acknowledgeMode=AUTO local queue size=0
24-11-08.13:09:03.780 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.13:12:17.770 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m45s827ms786µs920ns).
24-11-08.13:12:17.770 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=3m24s608ms284µs449ns).
24-11-08.13:12:17.775 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.13:12:17.780 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] ERROR SimpleMessageListenerContainer - Failed to check/redeclare auto-delete queue(s).
org.springframework.amqp.AmqpIOException: java.io.IOException
	at org.springframework.amqp.rabbit.support.RabbitExceptionTranslator.convertRabbitAccessException(RabbitExceptionTranslator.java:70)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:603)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:725)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createBareChannel(CachingConnectionFactory.java:676)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.getCachedChannelProxy(CachingConnectionFactory.java:650)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.getChannel(CachingConnectionFactory.java:540)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.access$1600(CachingConnectionFactory.java:100)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory$ChannelCachingConnectionProxy.createChannel(CachingConnectionFactory.java:1418)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.doExecute(RabbitTemplate.java:2216)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:2183)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:2163)
	at org.springframework.amqp.rabbit.core.RabbitAdmin.getQueueInfo(RabbitAdmin.java:463)
	at org.springframework.amqp.rabbit.core.RabbitAdmin.getQueueProperties(RabbitAdmin.java:447)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.attemptDeclarations(AbstractMessageListenerContainer.java:1942)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.redeclareElementsIfNecessary(AbstractMessageListenerContainer.java:1915)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.initialize(SimpleMessageListenerContainer.java:1384)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:1230)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.io.IOException: null
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:129)
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:125)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:147)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:439)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:1225)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:1173)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.connectAddresses(AbstractConnectionFactory.java:641)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.connect(AbstractConnectionFactory.java:616)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:566)
	... 16 common frames omitted
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error
	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:66)
	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:36)
	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:502)
	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:293)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:141)
	... 22 common frames omitted
Caused by: java.io.EOFException: null
	at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:290)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:91)
	at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:184)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:665)
	... 1 common frames omitted
24-11-08.13:12:26.734 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1fcaea93:2/SimpleConnection@7493e07f [delegate=amqp://admin@127.0.0.1:5672/, localPort= 49304]
24-11-08.13:12:37.391 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: null
24-11-08.13:12:37.392 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 null rule_default
24-11-08.13:12:37.393 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:12:37.415 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:12:37.433 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.13:12:37.434 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.13:12:37.436 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
java.lang.NullPointerException: null
	at site.mufen.infrastructure.persistent.repository.StrategyRepository.queryRuleTreeVOByTreeId(StrategyRepository.java:217)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$4915b6c7.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at site.mufen.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$f289b52.queryRuleTreeVOByTreeId(<generated>)
	at site.mufen.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicTree(DefaultRaffleStrategy.java:67)
	at site.mufen.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:65)
	at site.mufen.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:113)
	at site.mufen.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
24-11-08.13:21:44.690 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_432 on myarch with PID 62939 (started by mufen in /home/mufen/Downloads/big-market/big-market-app)
24-11-08.13:21:44.692 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
24-11-08.13:21:45.909 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
24-11-08.13:21:45.912 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
24-11-08.13:21:45.957 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 29 ms. Found 0 Redis repository interfaces.
24-11-08.13:21:47.765 [main            ] INFO  Version                - Redisson 3.23.4
24-11-08.13:21:48.048 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.13:21:48.065 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
24-11-08.13:21:52.301 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
24-11-08.13:21:52.381 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
24-11-08.13:21:52.446 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#591be8aa:0/SimpleConnection@75f8d9b0 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 42498]
24-11-08.13:21:52.540 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.4 seconds (JVM running for 9.277)
24-11-08.13:21:52.733 [main            ] INFO  RaffleActivityController - 活动抽奖 开始 userId:xiaofuge, activityId:100301
24-11-08.13:21:52.839 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:21:53.064 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:21:53.092 [main            ] INFO  AbstractRaffleActivityService - 创建参与抽奖活动订单[已存在未消费] userId:xiaofuge, activityId:ActivityEntity(activityId=100301, activityName=测试活动, activityDesc=测试活动, beginDateTime=Sat Mar 09 18:15:10 CST 2024, endDateTime=Thu Mar 09 18:15:10 CST 2034, strategyId=100006, state=open), userRaffleOrderEntity:UserRaffleOrderEntity(userId=xiaofuge, activityId=100301, activityName=测试活动, strategyId=100006, orderId=707494030054, orderTime=Fri Nov 08 12:24:56 CST 2024, orderState=create, endDateTime=null)
24-11-08.13:21:53.111 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: xiaofuge strategyId: 100006 ruleModel: rule_default awardId: 102
24-11-08.13:21:53.111 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 102 rule_default
24-11-08.13:21:53.112 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
24-11-08.13:21:53.138 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
24-11-08.13:21:53.151 [main            ] INFO  RuleStockLogicTreeNode - 规则过滤-库存扣减 userId:xiaofuge strategyId:100006 awardId:102
24-11-08.13:21:53.184 [main            ] INFO  DecisionTreeEngine     - 决策树引擎【规则树-兜底奖励】treeId:tree_luck_award node:rule_stock code:0001
24-11-08.13:21:53.185 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-规则树 xiaofuge 100006 102 null
24-11-08.13:21:53.389 [main            ] INFO  EventPublisher         - 发送MQ消息 topic: send_award, message: {"data":{"awardId":102,"awardTitle":"7等奖","userId":"xiaofuge"},"id":"70325737999","timestamp":1731043313192}
24-11-08.13:21:53.389 [main            ] INFO  AwardRepository        - 更新task表 任务消息发送完成
24-11-08.13:21:53.398 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":102,"awardTitle":"7等奖","userId":"xiaofuge"},"id":"70325737999","timestamp":1731043313192}
24-11-08.13:21:53.400 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
24-11-08.13:21:53.404 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":102,"awardIndex":2,"awardTitle":"7等奖"},"info":"成功"}
24-11-08.13:21:53.418 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.13:21:53.418 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
24-11-08.13:21:53.513 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.13:21:54.401 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
24-11-08.13:21:54.405 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
24-11-08.13:21:54.405 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
